<!doctype html>
<html>
<head>
<title>Example Domain</title>

<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
<style type="text/css">
* {
margin: 0;
padding: 0;
list-style: none;
font-family: 'Lato', sans-serif;
line-height: 1;
}
body {
background-color: #f5f6f8;
overflow: hidden;
}
.sidebar-navigation {
display: inline-block;
min-height: 100vh;
width: 80px;
background-color: #313443;
float: left;
margin-right: 2em;
}
.sidebar-navigation ul {
text-align: center;
color: white;
}
.sidebar-navigation ul li {
padding: 28px 0;
cursor: pointer;
transition: all ease-out 120ms;
}
.sidebar-navigation ul li i {
display: block;
font-size: 24px;
transition: all ease 450ms;
}
.sidebar-navigation ul li .tooltip {
display: inline-block;
position: absolute;
background-color: #313443;
padding: 8px 15px;
border-radius: 3px;
margin-top: -26px;
left: 90px;
opacity: 0;
visibility: hidden;
font-size: 13px;
letter-spacing: 0.5px;
}
.sidebar-navigation ul li .tooltip:before {
content: '';
display: block;
position: absolute;
left: -4px;
top: 10px;
transform: rotate(45deg);
width: 10px;
height: 10px;
background-color: inherit;
}
.sidebar-navigation ul li:hover {
background-color: #22252e;
}
.sidebar-navigation ul li:hover .tooltip {
visibility: visible;
opacity: 1;
}
.sidebar-navigation ul li.active {
background-color: #22252e;
}
.sidebar-navigation ul li.active i {
color: #98d7ec;
}
div {
width: 600px;
padding: 2em;
}
@media (max-width: 700px) {
div {
margin: 0 auto;
width: auto;
}
}
</style>    

<script src="app/jquery.min.js"></script>
<script src="app/fabric.min.js"></script>
<script src="app/FileSaver.js"></script>
<script src="app/canvas-toBlob.js"></script>
</head>

<body>
<nav class="sidebar-navigation">
<ul>
<li class="active">
<i class="fa fa-share-alt"></i>
<span class="tooltip">Connections</span>
</li>
<li>
<i class="fa fa-hdd-o"></i>
<span class="tooltip">Devices</span>
</li>
<li>
<i class="fa fa-newspaper-o"></i>
<span class="tooltip">Contacts</span>
</li>
<li>
<i class="fa fa-print"></i>
<span class="tooltip">Fax</span>
</li>
<li>
<i class="fa fa-sliders"></i>
<span class="tooltip">Settings</span>
</li>
</ul>
</nav>

<div>
HELLO WORLD!
</div>
	
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script>
$('ul li').on('click', function() {
	$('li').removeClass('active');
	$(this).addClass('active');
});
</script>

<script>
var canvas = new fabric.Canvas('imageCanvas', {
backgroundColor: 'rgb(240,240,240)'
});
  
fabric.Object.prototype.transparentCorners = false;
fabric.Object.prototype.originX = fabric.Object.prototype.originY = 'center';
  
canvas.selection = false;
canvas.setWidth(600);
canvas.setHeight(600);

var imageLoader = document.getElementById('photo');
imageLoader.addEventListener('change', handleImage, false);

function handleImage(e) {
var objects = canvas.getObjects();
for (var i in objects) {
objects[i].remove();
}
var reader = new FileReader();
reader.onload = function(event) {
var img = new Image();
img.onload = function() {
var imgInstance = new fabric.Image(img, {
selectable: 1,
borderColor: 'black',
cornerColor: 'black',
cornerSize: 30
})
canvas.add(imgInstance);
/* var red = new fabric.Rect({ width: 600, height: 600, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}

var iimageLoader = document.getElementById('frame');
iimageLoader.addEventListener('change', handleImage, false);

function handleImage(f) {
var objects = canvas.getObjects();
/* for (var i in objects) {
objects[i].remove();
} */
var reader = new FileReader();
reader.onload = function(event) {

var fimg = new Image();
fimg.onload = function() {
var fimgInstance = new fabric.Image(fimg, {
selectable: 0,
width: 600,
height: 600
})
canvas.add(fimgInstance);
fimgInstance.center();
/* var red = new fabric.Rect({ width: 600, height: 600, fill: 'red'})
canvas.add(red);
red.center(); */
canvas.deactivateAll().renderAll();
}
fimg.src = event.target.result;
}
reader.readAsDataURL(f.target.files[0]);
}

img.src = event.target.result;

}
reader.readAsDataURL(e.target.files[0]);
}

canvas.on({
'object:moving': function(e) {
e.target.opacity = 0.5;
},
'object:modified': function(e) {
e.target.opacity = 1;
}
});


var font = new fabric.Text('HELLO WORLD!', { 
fill: 'black',
originX: 'center',
originY: 'center'
}); 
canvas.add(font); 
canvas.centerObject(font);
  
$("#dl").click(function(){
$("#imageCanvas").get(0).toBlob(function(blob){
saveAs(blob, "image.png");
});
});

function checkInput() {
var input = document.getElementById('photo').value;
var input2 = document.getElementById('frame').value;
var button = document.getElementById('dl');
var button2 = document.getElementById('shared');
button.disabled = input === '';
button2.disabled = input2 === '';
}
</script>
<script>
document.getElementById("shared").addEventListener("click", () => {
alert("share image");
const dataUrl = canvas.toDataURL(); 
fetch(dataUrl)
.then(res => res.blob())
.then(blob => {
//console.log(blob)
const filesArray = [new File([blob], 'image.png', { type: blob.type, lastModified: new Date().getTime() })];
console.log(filesArray);
const shareData = {
title: "FREE AND SIMPLE PFP GENERATOR",
text: "FREE AND SIMPLE PFP GENERATOR",
url: "https://jiinbe.github.io/fabricjs2/",
files: filesArray
};
console.log(shareData);
if (navigator.share) {
navigator.share(
shareData
)
.then(() => alert("thanks for share")) 
.catch(error => alert("error", error)); 
} else {
alert('navigator.share not available'); 
}
})
});
</script>
</body>
</html>
